<?xml version="1.0" encoding="UTF-8"?>

<project default="jar" name="xfire-client" basedir=".">

  <property name="tools.compiler" value="1.4"/>

  <import file="../../build-module.xml"/>

  <path id="build.classpath">
    <path refid="base.libs"/>
    <path refid="core.libs"/>
    <path refid="xfire.libs"/>
    <path refid="xfire.client.libs"/>

    <fileset dir="${core.basedir}/target">
      <include name="${jar.pattern}"/>
    </fileset>

    <pathelement location="${core.basedir}/target/test-classes"/>
    <pathelement location="${basedir}/target/examples/schema/classes/xfire-client/jdk14"/>
  </path>

  <property name="in.apt.src.test.dir" value="${basedir}/src/samples/xfire-client"/>

  <target name="-init">
    <pathconvert property="apt.test.class.path" pathsep="${path.separator}" dirsep="${file.separator}">
      <path>
        <path refid="build.classpath"/>
      </path>
    </pathconvert>

    <propertyset id="test.sysprops">
      <propertyref name="in.apt.src.test.dir"/>
      <propertyref name="enunciate.sample.src.dir"/>
      <propertyref name="apt.test.class.path"/>
    </propertyset>
  </target>

  <target name="init" depends="base.init, -init"/>

  <target name="compile-main" depends="base.compile-main">
    <mkdir dir="${build.dir}/META-INF/services"/>
    <echo message="net.sf.enunciate.modules.xfire_client.XFireClientDeploymentModule"
          file="${build.dir}/META-INF/services/net.sf.enunciate.modules.DeploymentModule"/>
  </target>

  <target name="compile-shapes">
    <mkdir dir="${test.build.dir}"/>
    <javac destdir="${test.build.dir}" debug="true">
      <src>
        <pathelement location="src/samples/schema"/>
      </src>
      <classpath refid="base.libs"/>
    </javac>
  </target>

  <target name="compile-tests" depends="compile-shapes, base.compile-tests"/>

  <target name="test" depends="shapes, base.test"/>

  <target name="shapes" depends="compile-main">
    <path id="enunciate.classpath">
      <path refid="base.libs"/>
      <path refid="core.libs"/>
      <pathelement location="${build.dir}"/>
    </path>

    <antcall target="enunciate-example-api">
      <param name="enunciate.target" value="compile"/>
      <param name="example" value="schema"/>
      <param name="example.dir" value="${basedir}/src/samples/schema"/>
      <reference refid="enunciate.classpath"/>
    </antcall>
  </target>

</project>
